<div class="card border-0 shadow-sm mb-4 rounded-4 overflow-hidden">
  <div class="card-body pb-2">
    <div class="d-flex align-items-center justify-content-between mb-3">
      <div class="d-flex align-items-center">
        <a [routerLink]="['/profile', post.authorUsername]" class="text-decoration-none">
          <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center me-3 shadow-sm" 
               style="width: 45px; height: 45px; font-weight: bold; font-size: 1.2rem;">
            {{ post.authorUsername?.charAt(0) | uppercase }}
          </div>
        </a>
        <div>
          <h6 class="mb-0 fw-bold text-dark text-capitalize">{{ post.authorUsername }}</h6>
          <small class="text-muted" style="font-size: 0.75rem;">
            <i class="bi bi-clock me-1"></i>{{ post.createdAt | date:'medium' }}
          </small>
        </div>
      </div>

      <div class="dropdown">
        <button class="btn btn-link text-secondary p-2 border-0 shadow-none" type="button" data-bs-toggle="dropdown">
          <i class="bi bi-three-dots-vertical fs-5"></i>
        </button>
        <ul class="dropdown-menu dropdown-menu-end shadow-sm border-0 p-2 rounded-3">
          @if (post.authorUsername === currentUser?.username) {
            <li><button class="dropdown-item rounded-2" (click)="onEditClick()"><i class="bi bi-pencil me-2"></i> Edit</button></li>
            <li><button class="dropdown-item rounded-2 text-danger" (click)="onDeletePost()"><i class="bi bi-trash3 me-2"></i> Delete</button></li>
          } @else {
            <li>
              <button class="dropdown-item rounded-2 text-danger" 
                      (click)="openReportModal(post.id)" 
                      data-bs-toggle="modal" 
                      [attr.data-bs-target]="'#reportModal' + post.id">
                <i class="bi bi-flag me-2"></i> Report Post
              </button>
            </li>
          }
        </ul>
      </div>
    </div>

    <p class="card-text fs-6 text-dark px-1">{{ post.description }}</p>

    <div class="post-media-container mt-3 mb-2 bg-light rounded-3 border overflow-hidden shadow-sm">
      @if (isImage(post.mediaUrl)) {
        <img [src]="'http://localhost:8080' + post.mediaUrl" 
             class="img-fluid w-100 object-fit-contain" 
             style="max-height: 550px;" />
      }
      @if (isVideo(post.mediaUrl)) {
        <video controls class="w-100 h-100 bg-black">
          <source [src]="'http://localhost:8080' + post.mediaUrl" type="video/mp4" />
        </video>
      }
    </div>
  </div>

  <div class="card-footer bg-white border-0 d-flex justify-content-around py-2 border-top">
    <button class="btn btn-link text-decoration-none w-50 py-2" (click)="onLike(post)" [disabled]="post.isLiking">
      <i class="bi fs-5" [ngClass]="post.liked ? 'bi-heart-fill text-danger' : 'bi-heart text-secondary'"></i>
      <span class="ms-2 fw-semibold" [class.text-danger]="post.liked">{{ post.liked ? 'Liked' : 'Like' }}</span>
    </button>
    
    <button class="btn btn-link text-decoration-none text-secondary w-50 py-2 border-start" (click)="onToggleComments(post)">
      <i class="bi bi-chat-left-text fs-5 me-2"></i>
      <span class="fw-semibold">Comment</span>
    </button>
  </div>
</div>

<div class="modal fade" [id]="'reportModal' + post.id" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg rounded-4">
      <div class="modal-header border-0 pb-0">
        <h5 class="modal-title fw-bold text-danger"><i class="bi bi-exclamation-triangle-fill me-2"></i>Report Post</h5>
        <button type="button" class="btn-close shadow-none" data-bs-dismiss="modal" (click)="closeModal()"></button>
      </div>
      <div class="modal-body">
        <p class="text-muted small">Why are you reporting this post?</p>
        <textarea 
          class="form-control border-light-subtle rounded-3 shadow-sm" 
          rows="4" 
          placeholder="E.g. Inappropriate content, spam..."
          [(ngModel)]="reportReason">
        </textarea>
      </div>
      <div class="modal-footer border-0 pt-0">
        <button type="button" 
                [id]="'closeReportModal' + post.id" 
                class="btn btn-light rounded-pill px-4 fw-semibold" 
                data-bs-dismiss="modal">
          Cancel
        </button>
        <button 
          type="button" 
          class="btn btn-danger rounded-pill px-4 fw-semibold" 
          [disabled]="!reportReason.trim() || isReporting"
          (click)="submitReport()">
          @if (isReporting) {
            <span class="spinner-border spinner-border-sm me-2"></span>
          }
          Submit Report
        </button>
      </div>
    </div>
  </div>
</div>