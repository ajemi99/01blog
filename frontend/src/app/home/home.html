<!-- <div class="container">

<button class="create-post-btn" (click)="openCreatePost()">Create Post</button>

</div> -->

<!-- Popup -->
<!-- <div class="popup" *ngIf="showPopup">
  <app-create-post
    [mode]="editMode ? 'edit' : 'create'"
    [postData]="selectedPost"
    (postCreated)="onPostCreated($event)">
    <button class="close-btn" (click)="closePopup()">Ã—</button>
  </app-create-post>
</div> -->

<!-- Posts List -->
<!-- <app-post-list 
  [posts]="posts" 
  (editRequested)="openEditPost($event)"
  (deleteRequested)="deletePost($event)">
</app-post-list> -->
<div class="container mt-5 pt-3">
  <div class="row g-4 justify-content-center">
    
    <div class="col-12 col-lg-8">
      
      <app-create-post #createPostComp (postCreated)="onNewPostCreated($event)"></app-create-post>

      @for (post of posts; track post.id) {
        <div class="card border-0 shadow-sm mb-4 rounded-3">
          <div class="card-body">
            
            <div class="d-flex align-items-center justify-content-between mb-3">
              <div class="d-flex align-items-center">
                <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center me-2" style="width: 42px; height: 42px; font-weight: bold;">
                  {{ post.authorUsername?.charAt(0) | uppercase }}
                </div>
                <div>
                  <h6 class="mb-0 fw-bold text-capitalize">{{ post.authorUsername }}</h6>
                  <small class="text-muted">{{ post.createdAt | date:'medium' }}</small>
                </div>
              </div>

              <div class="dropdown">
                <button class="btn btn-link text-secondary p-0 border-0 shadow-none" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                  <i class="bi bi-three-dots-vertical fs-5"></i>
                </button>
                <ul class="dropdown-menu dropdown-menu-end shadow border-0 p-2 rounded-3">
                  
                  @if (isOwner(post)) {
                    <li>
                      <button class="dropdown-item rounded-2 py-2" (click)="createPostComp.openEditMode(post)">
                        <i class="bi bi-pencil me-2 text-primary"></i> Edit Post
                      </button>
                    </li>
                    <li>
                      <button class="dropdown-item rounded-2 py-2 text-danger" (click)="onDelete(post.id)">
                        <i class="bi bi-trash3 me-2"></i> Delete
                      </button>
                    </li>
                    <li><hr class="dropdown-divider"></li>
                  }

                  <li>
                    <button class="dropdown-item rounded-2 py-2 text-warning">
                      <i class="bi bi-flag me-2"></i> Report
                    </button>
                  </li>
                </ul>
              </div>
            </div>

            <p class="card-text fs-6">{{ post.description }}</p>

            <div class="post-media-container mt-3 mb-2 bg-light rounded border overflow-hidden">
              @if (isImage(post.mediaUrl)) {
                <img [src]="'http://localhost:8080' + post.mediaUrl" 
                     class="img-fluid w-100 object-fit-contain" 
                     style="max-height: 500px;" />
              }

              @if (isVideo(post.mediaUrl)) {
                <video controls class="w-100 h-100 shadow-sm bg-black">
                  <source [src]="'http://localhost:8080' + post.mediaUrl" type="video/mp4" />
                  Your browser does not support the video tag.
                </video>
              }
            </div>
          </div>

          <div class="card-footer bg-white border-0 d-flex justify-content-around pb-3 text-secondary border-top">
            <button class="btn btn-link text-decoration-none text-secondary w-50 py-2 post-action-btn">
              <i class="bi bi-heart me-1"></i> Like
            </button>
            <button class="btn btn-link text-decoration-none text-secondary w-50 py-2 post-action-btn border-start">
              <i class="bi bi-chat me-1"></i> Comment
            </button>
          </div>
        </div>
      } @empty {
        <div class="text-center p-5 text-muted bg-white rounded shadow-sm">
          <i class="bi bi-postage fs-1 d-block mb-3"></i>
          <p class="fw-bold">No posts yet. Be the first to post!</p>
        </div>
      }
    </div>
  </div>
</div>